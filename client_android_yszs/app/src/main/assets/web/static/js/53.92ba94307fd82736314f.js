webpackJsonp([53],{Q9NA:function(t,e){},qNzO:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("aA9S"),a=i.n(s),r=i("lC5x"),n=i.n(r),u=i("J0Oq"),o=i.n(u),c=i("4YfN"),l=i.n(c),d=i("N3LN"),p=i("/9Wm"),b=i("HNeU"),m=i("wBUC"),f=i("gyMJ"),k=i("9ER+"),y=i("fUgm"),T={components:{DatepickBar:d.a,BusItemCanbuy:p.a,BusItemDisable:p.a,ListSortBar:m.a,ListSortBarItem:m.b,TicketTypeChoose:b.a},props:{tripName:{type:String,default:""},tripId:{type:[String,Number],default:""},time:{type:[String,Number]}},data:function(){return{flag:1,pickedDate:this.time||this.queryDate||Object(k.f)(new Date),isLoaded:!1,dialogIsShow:!1,msgContent:"",minTicketAmounts:1,timeToDep:10,allBusList:[],busListCanBuy:[],busListDisable:[],luxuryTicketInfo:[],showLuxuryTicketInfo:!1,busItem:{},sortSelected:0}},computed:l()({},Object(y.b)(["queryHistory","queryDate","canWebBuyDays"]),{lastHistory:function(){var t=this.queryHistory.luxbus;return t&&t.slice(-1)[0]},travel:function(){return this.tripName||this.lastHistory&&this.lastHistory.trip.name},id:function(){return this.tripId||this.lastHistory&&this.lastHistory.trip.id}}),mounted:function(){var t=new Date;new Date(this.pickedDate).getTime()<t.getTime()&&(this.pickedDate=Object(k.f)(t)),this.getLuxuryBusList()},methods:{getSingle:function(t){var e=this;return o()(n.a.mark(function i(){var s,a,r,u,o,c,l,d,p,b,m;return n.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return s=t.sbId,a=t.busCode,r=t.depotId,u=t.beginStationId,o=t.fullPrice,c=t.endStationId,l=t.circleRun,d={sbId:s,busCode:a,depotId:r,beginStationId:u,endStationId:c,circleRun:l,fullPrice:o,busId:t.busNumber,endStationName:t.toStationName,leaveDate:e.pickedDate,leaveTime:t.fromTime,beginStationName:t.fromStationName},i.next=5,Object(f.e)(d);case 5:if(!(p=t.disableReason)){i.next=9;break}return e.showDialog("该班次"+p+",请选择当日其他班次或换个日期试试"),i.abrupt("return");case 9:return b={id:e.id,busNumber:t.busNumber,date:e.pickedDate},i.next=12,Object(f._5)(b);case 12:if(m=i.sent,e.luxuryTicketInfo=m.luxuryTicketInfo.filter(function(e,i,s){return"儿童特票"!==e.ticketType&&("成人票(怀抱婴幼儿)"!==e.ticketType&&("儿童票"===e.ticketType||"儿童/军残"===e.ticketType?(t.childPrice=e.price,!1):("成人票"===e.ticketType&&(e.ticketType="通票"),e)))}),e.luxuryTicketInfo&&0!==e.luxuryTicketInfo.length){i.next=17;break}return e.$toast("该班次票均已售完"),i.abrupt("return");case 17:e.luxuryTicketInfo.filter(function(t,e){1===parseInt(t.surplusTicket)&&(t.surplusTicket=0)}),e.showLuxuryTicketInfo=!0,e.busItem=t;case 20:case"end":return i.stop()}},i,e)}))()},toBusOrder:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.showLuxuryTicketInfo&&(this.showLuxuryTicketInfo=!1),parseInt(t.surplusTicket)>0){var e=a()({},this.busItem,{queryDate:this.pickedDate,fullPrice:t.price,surplusTicket:t.surplusTicket,ticketType:t.ticketType,handlingFee:0,category:"luxury-bus",tripId:this.id,limit:this.busItem.orderTicketCount<t.surplusTicket?this.busItem.orderTicketCount:t.surplusTicket});this.$store.commit("SET_DETAILDATA",{type:"bus",value:e}),this.$router.push({path:"luxury-bus-list/order"})}else this.showDialog("余票不足，无法订票")},getLuxuryBusList:function(){var t=this;return o()(n.a.mark(function e(){var i;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.id&&t.pickedDate){e.next=2;break}return e.abrupt("return");case 2:return i={id:t.id,date:t.pickedDate},t.isLoaded=!1,e.next=6,Object(f._4)(i);case 6:t.allBusList=e.sent,t.busListCanBuy=t.filterBusList(t.allBusList,!0),t.busListDisable=t.filterBusList(t.allBusList,!1),t.isLoaded=!0;case 10:case"end":return e.stop()}},e,t)}))()},filterBusList:function(t,e){var i=this,s=Date.now(),a=this.pickedDate.replace(/-/g,"/");return t.filter(function(t){var r=new Date(a+" "+t.fromTime).getTime();return t.backTime&&(t.toDateTime=Object(k.d)(i.queryDate)+" "+t.fromTime,t.backDateTime=Object(k.d)(t.backDate)+" "+t.backTime),e?r-s>=60*i.timeToDep*1e3:r<=s?(t.disableReason="已发车",!1):r-s<=60*i.timeToDep*1e3&&(t.disableReason="暂停售票",!0)})},showDialog:function(t){this.dialogIsShow=!0,this.msgContent=t},touchSort:function(){this.$refs["main-page"].scrollToTop(0)}},watch:{pickedDate:function(t){this.getLuxuryBusList()}}},h={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("main-page",{ref:"main-page",staticClass:"luxury-bus-ticket-container",attrs:{title:t.travel,isLoading:!t.isLoaded,data:t.allBusList,back:""}},[i("datepick-bar",{attrs:{canWebBuyDays:t.canWebBuyDays},model:{value:t.pickedDate,callback:function(e){t.pickedDate=e},expression:"pickedDate"}}),t._v(" "),i("section",{staticClass:"bus-ticket-list-container",attrs:{slot:"scroll"},slot:"scroll"},[i("div",t._l(t.busListCanBuy,function(e,s){return i("bus-item-canbuy",{key:s,attrs:{startPort:e.fromStationName,endPort:e.toStationShow||e.toStationName,price:e.fullPrice,busType:e.busType,depTime:e.fromTime,toTime:e.toDateTime,backTime:e.backDateTime},nativeOn:{click:function(i){return t.getSingle(e)}}})}),1),t._v(" "),i("div",t._l(t.busListDisable,function(t,e){return i("bus-item-disable",{key:e,attrs:{depTime:t.fromTime,startPort:t.fromStationName,endPort:t.toStationShow||t.toStationNamee,price:t.fullPrice,busType:t.busType,disable:"",reason:t.disableReason}})}),1)]),t._v(" "),i("l-dialog",{staticClass:"disable-tip-dialog-wrapper",attrs:{show:t.dialogIsShow},on:{"update:show":function(e){t.dialogIsShow=e}}},[i("p",{staticClass:"msg-content"},[t._v(t._s(t.msgContent))])]),t._v(" "),i("ticket-type-choose",{attrs:{show:t.showLuxuryTicketInfo,ticketTypes:t.luxuryTicketInfo},on:{"update:show":function(e){t.showLuxuryTicketInfo=e},choose:t.toBusOrder}})],1)},staticRenderFns:[]};var D=i("C7Lr")(T,h,!1,function(t){i("Q9NA")},null,null);e.default=D.exports}});