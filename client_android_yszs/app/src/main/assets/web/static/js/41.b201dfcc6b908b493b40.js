webpackJsonp([41],{SDY4:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("lC5x"),a=s.n(i),o=s("HzJ8"),r=s.n(o),n=s("J0Oq"),c=s.n(n),l=s("aA9S"),u=s.n(l),p=s("4YfN"),d=s.n(p),m=s("N3LN"),f=s("HNeU"),v=s("wBUC"),T=s("gyMJ"),h=s("fUgm"),y={components:{DatepickBar:m.a,TicketTypeChoose:f.a,ListSortBar:v.a,ListSortBarItem:v.b},props:{from:String,to:String,time:String},computed:d()({},Object(h.b)(["queryHistory","queryDate","canWebBuyDays"]),{lastHistory:function(){return this.queryHistory.train.slice(-1)[0]},fromStationCode:function(){return this.from||this.lastHistory&&this.lastHistory.start.code},toStationCode:function(){return this.to||this.lastHistory&&this.lastHistory.end.code}}),data:function(){return{dateTime:this.time,list:[],isLoaded:!1,showTicketTypes:!1,choosedItem:{},sortSelected:0,priceTexts:["按价格排序","价格从低到高","价格从高到低"],timeTexts:["按时间排序","时间从早到晚","时间从晚到早"]}},mounted:function(){this.dateTime=this.time||this.queryDate,this.getTrainList()},watch:{dateTime:function(){this.getTrainList()}},methods:{toDetail:function(t){t.seatInfo&&0===t.seatInfo.length||(this.choosedItem=t,this.showTicketTypes=!0)},chooseTicket:function(t){this.showTicketTypes=!1;var e=u()({},this.choosedItem,{category:"train",queryDate:this.dateTime,ticketType:t.ticketType,price:t.price,surplusTicket:parseInt(t.surplusTicket)||99,fromStationCode:this.fromStationCode,toStationCode:this.toStationCode});this.$store.commit("SET_DETAILDATA",{type:"train",value:e}),this.$router.push({name:"TrainTicketDetail"})},getTrainList:function(){var t=this;return c()(a.a.mark(function e(){var s,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s={sCityCode:t.fromStationCode,eCityCode:t.toStationCode,date:t.dateTime},t.isLoaded=!1,e.next=4,Object(T.T)(s);case 4:if(i=e.sent){e.next=7;break}return e.abrupt("return");case 7:t.isLoaded=!0,t.list=i,t.list.filter(function(t,e){var s=!0,i=!1,a=void 0;try{for(var o,n=r()(t.seatInfo);!(s=(o=n.next()).done);s=!0){var c=o.value;isNaN(c.surplusTicket)?("有"===c.surplusTicket&&(c.template='<span style="color: #26a2ff">'+c.surplusTicket+"票</span>"),"无"===c.surplusTicket&&(c.template='<span style="color: #bbb">'+c.surplusTicket+"票</span>")):c.template='<span><span style="color: #26a2ff">'+c.surplusTicket+"</span>张</span>"}}catch(t){i=!0,a=t}finally{try{!s&&n.return&&n.return()}finally{if(i)throw a}}return t});case 10:case"end":return e.stop()}},e,t)}))()},touchSort:function(){this.$refs["main-page"].scrollToTop(0)}}},_={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("main-page",{ref:"main-page",staticClass:"train-ticket-list",attrs:{back:"",title:"火车票列表",isLoading:!t.isLoaded,data:t.list}},[s("datepick-bar",{attrs:{canWebBuyDays:t.canWebBuyDays},model:{value:t.dateTime,callback:function(e){t.dateTime=e},expression:"dateTime"}}),t._v(" "),s("section",{staticClass:"train-ticket-list-wrapper",attrs:{slot:"scroll"},slot:"scroll"},t._l(t.list,function(e,i){return s("div",{key:i,staticClass:"train-ticket-list-item",on:{click:function(s){return t.toDetail(e)}}},[s("div",{staticClass:"train-ticket-list-item-content"},[s("div",{staticClass:"place place-from"},[s("div",{staticClass:"station"},[t._v(t._s(e.fromStationName))]),t._v(" "),s("div",{staticClass:"datetime"},[t._v(t._s(e.fromTime))])]),t._v(" "),s("div",{staticClass:"icon-arrow"},[s("div",{staticClass:"arrow-top"},[t._v(t._s(e.trainNumber))]),t._v(" "),s("i",{staticClass:"city-to"}),t._v(" "),s("div",{staticClass:"arrow-bottom"},[t._v(t._s(e.costTime))])]),t._v(" "),s("div",{staticClass:"place place-to"},[s("div",{staticClass:"station"},[t._v(t._s(e.toStationName))]),t._v(" "),s("div",{staticClass:"datetime"},[t._v(t._s(e.toTime))])]),t._v(" "),s("div",{staticClass:"price-wrapper"},[s("span",{staticClass:"price"},[s("span",{staticClass:"price-symbol"},[t._v("￥")]),s("span",[t._v(t._s(e.minPrice))])]),t._v(" "),s("span",[t._v("起")]),t._v(" "),s("div",{staticClass:"tips"})])]),t._v(" "),s("div",{staticClass:"train-ticket-list-item-seats"},[e.seatInfo&&0!==e.seatInfo.length?t._l(e.seatInfo,function(e,i){return s("span",{key:i},[t._v("\n            "+t._s(e.ticketType+":")+"\n            "),t._v(" "),s("span",{domProps:{innerHTML:t._s(e.template)}})])}):s("div",{staticClass:"info"},[t._v("该班次因特殊原因停售")])],2)])}),0),t._v(" "),s("list-sort-bar",{attrs:{slot:"bottom",list:t.list},slot:"bottom",model:{value:t.sortSelected,callback:function(e){t.sortSelected=e},expression:"sortSelected"}},[s("list-sort-bar-item",{attrs:{sortKey:"fromTime",sortTexts:t.timeTexts,icon:"time-xianxing"},nativeOn:{click:function(e){return t.touchSort(e)}}}),t._v(" "),s("list-sort-bar-item",{attrs:{sortKey:"minPrice",sortTexts:t.priceTexts,icon:"caiwu-xianxing"},nativeOn:{click:function(e){return t.touchSort(e)}}})],1),t._v(" "),s("ticket-type-choose",{attrs:{show:t.showTicketTypes,ticketTypes:t.choosedItem.seatInfo},on:{"update:show":function(e){t.showTicketTypes=e},choose:t.chooseTicket}})],1)},staticRenderFns:[]};var k=s("C7Lr")(y,_,!1,function(t){s("dfXF")},null,null);e.default=k.exports},dfXF:function(t,e){}});