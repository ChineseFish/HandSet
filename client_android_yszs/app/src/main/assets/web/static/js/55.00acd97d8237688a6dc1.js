webpackJsonp([55],{QQzu:function(t,e){},UVI7:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("lC5x"),a=i.n(s),r=i("aA9S"),n=i.n(r),o=i("J0Oq"),c=i.n(o),u=i("4YfN"),l=i.n(u),d=i("N3LN"),m=i("/9Wm"),p=i("wBUC"),f=i("9ER+"),b=i("gyMJ"),h=i("fUgm"),y={components:{DatepickBar:d.a,BusItemCanbuy:m.a,BusItemDisable:m.a,ListSortBar:p.a,ListSortBarItem:p.b},props:{from:{type:String,default:""},to:{type:String,default:""},time:{type:[String,Number]}},data:function(){return{sortId:-1,flag:0,pickedDate:this.time,isLoaded:!1,dialogIsShow:!1,msgContent:"",disableTimePeriodStart:0,disableTimePeriodEnd:6,minTicketAmounts:1,timeToDep:30,allBusList:[],busListCanBuy:[],busListDisable:[],sortSelected:0,recommendData:{}}},computed:l()({},Object(h.b)(["queryHistory","queryDate","canWebBuyDays"]),{lastHistory:function(){var t=this.queryHistory.bus;return t&&t.slice(-1)[0]},start:function(){return this.from||this.lastHistory&&this.lastHistory.start.cname},end:function(){return this.to||this.lastHistory&&this.lastHistory.end.cname}}),mounted:function(){var t=new Date;this.pickedDate=this.time||this.queryDate||Object(f.f)(t),new Date(this.pickedDate).getTime()<t.getTime()&&(this.pickedDate=Object(f.f)(t)),this.relatedQuerySH(),this.getBusList()},methods:{relatedQuerySH:function(){var t=["定海","新城","舟山","普陀"];"上海"===this.start&&t.indexOf(this.end)>-1&&(this.recommendData={tripName:"上海黄浦旅游集散站 - 舟山",tripId:5,time:this.pickedDate}),t.indexOf(this.start)>-1&&"上海"===this.end&&(this.recommendData={tripName:"普陀客运站 - 上海黄浦旅游集散站",tripId:601,time:this.pickedDate}),"定海"===this.start&&"上海"===this.end&&(this.recommendData={tripName:"定海南站 - 上海黄浦旅游集散站",tripId:6,time:this.pickedDate}),this.recommendData.labels=[{title:"更豪华",labelColor:"#ff7d13"},{title:"更舒适",labelColor:"#26a2ff"},{title:"更便捷",labelColor:"green"}],this.recommendData.minPrice=150},toRecommendRoute:function(t){if(t.tripId){var e=t.tripName,i=t.tripId,s=t.time;this.$router.push({path:"/bus-ticket/luxury-bus-list",query:{tripName:e,tripId:i,time:s}})}},toBusOrder:function(t){var e=this;return c()(a.a.mark(function i(){var s,r,o,c,u,l,d,m,p,f,h;return a.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!(s=t.disableReason)){i.next=4;break}return e.showDialog("该班次"+s+",请选择当日其他班次或换个日期试试"),i.abrupt("return");case 4:return r=t.sbId,o=t.busCode,c=t.depotId,u=t.beginStationId,l=t.fullPrice,d=t.endStationId,m=t.circleRun,p={sbId:r,busCode:o,depotId:c,beginStationId:u,endStationId:d,circleRun:m,fullPrice:l,busId:t.busNumber,endStationName:t.toStationName,leaveDate:e.pickedDate,leaveTime:t.fromTime,beginStationName:t.fromStationName},i.next=9,Object(b.e)(p);case 9:(f=i.sent)&&"childPrice"in f&&(t.childPrice=f.childPrice),h=n()({},t,{queryDate:e.pickedDate,limit:t.orderTicketCount<t.surplusTicket?t.orderTicketCount:t.surplusTicket,category:"bus"}),e.$store.commit("SET_DETAILDATA",{type:"bus",value:h}),e.$router.push({path:"/bus-ticket/list/order"});case 15:case"end":return i.stop()}},i,e)}))()},getBusList:function(){var t=this;return c()(a.a.mark(function e(){var i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.start&&t.end&&t.pickedDate){e.next=2;break}return e.abrupt("return");case 2:return i={sCity:t.start,eCity:t.end,date:t.pickedDate},t.cityAlais(i,"杭州西站","杭州汽车西站"),t.isLoaded=!1,e.next=7,Object(b._2)(i);case 7:if(e.t0=e.sent,e.t0){e.next=10;break}e.t0=[];case 10:t.allBusList=e.t0,t.busListCanBuy=t.filterBusList(t.allBusList,!0),t.busListDisable=t.filterBusList(t.allBusList,!1),t.busListCanBuy.sort(function(t,e){return t.fromTime>e.fromTime?1:-1}),t.isLoaded=!0;case 15:case"end":return e.stop()}},e,t)}))()},cityAlais:function(t,e,i){return t.sCity===e&&(t.sCity=i),t.eCity===e&&(t.eCity=i),t},filterBusList:function(t,e){var i=this,s=Date.now(),a=this.pickedDate.replace(/-/g,"/");return t.filter(function(t){var r=new Date(a+" "+t.fromTime).getTime(),n=t.showTicketInfo.match(/^[0-9]+/),o=n&&n[0];return t.surplusTicket=o||"",e?o>i.minTicketAmounts&&r-s>=60*i.timeToDep*1e3:r<=s?(t.showTicketInfo="已发车",!1):r-s<=60*i.timeToDep*1e3?(t.showTicketInfo="暂停售票",!0):o<=i.minTicketAmounts&&(t.showTicketInfo="无票",!0)})},showDialog:function(t){this.dialogIsShow=!0,this.msgContent=t},touchSort:function(){this.$refs["main-page"].scrollToTop(0)}},watch:{pickedDate:function(t){this.getBusList()}}},k={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("main-page",{ref:"main-page",staticClass:"bus-list-container",attrs:{title:t.start+" - "+t.end,isLoading:!t.isLoaded,data:t.allBusList,back:""}},[i("datepick-bar",{attrs:{canWebBuyDays:t.canWebBuyDays},model:{value:t.pickedDate,callback:function(e){t.pickedDate=e},expression:"pickedDate"}}),t._v(" "),i("section",{staticClass:"bus-ticket-list-container",attrs:{slot:"scroll"},slot:"scroll"},[t.recommendData.tripId?i("div",{directives:[{name:"is-link",rawName:"v-is-link"}],staticClass:"recommend-route-item",on:{click:function(e){return t.toRecommendRoute(t.recommendData)}}},[i("span",{staticClass:"tips"},[t._v("推荐乘坐的豪华大巴")]),t._v(" "),i("div",{staticClass:"title"},[t._v(t._s(t.recommendData.tripName))]),t._v(" "),i("div",{staticClass:"labels-wrapper"},t._l(t.recommendData.labels,function(e,s){return t.recommendData.labels?i("div",{key:s,staticClass:"label-item",style:{color:e.labelColor}},[i("span",{staticClass:"label"},[t._v(t._s(e.title))])]):t._e()}),0),t._v(" "),i("div",{staticClass:"price-wrapper"},[i("span",{staticClass:"price"},[t._v(t._s(t.recommendData.minPrice))]),t._v("起\n      ")])]):t._e(),t._v(" "),i("div",t._l(t.busListCanBuy,function(e,s){return i("bus-item-canbuy",{key:s,attrs:{depTime:e.fromTime,startPort:e.fromStationName,endPort:e.toStationShow||e.toStationName,price:e.fullPrice,busType:e.busType,amount:e.showTicketInfo},nativeOn:{click:function(i){return t.toBusOrder(e)}}})}),1),t._v(" "),i("div",t._l(t.busListDisable,function(t,e){return i("bus-item-disable",{key:e,attrs:{depTime:t.fromTime,startPort:t.fromStationName,endPort:t.toStationShow||t.toStationName,price:t.fullPrice,busType:t.busType,disable:"",reason:t.showTicketInfo}})}),1)]),t._v(" "),i("list-sort-bar",{attrs:{slot:"bottom",list:t.busListCanBuy},slot:"bottom",model:{value:t.sortSelected,callback:function(e){t.sortSelected=e},expression:"sortSelected"}},[i("list-sort-bar-item",{ref:"time-sort-item",attrs:{sortKey:"fromTime",sortText:"时间",icon:"time-xianxing"},nativeOn:{click:function(e){return t.touchSort(e)}}}),t._v(" "),i("list-sort-bar-item",{attrs:{sortKey:"fullPrice",sortText:"价格",icon:"caiwu-xianxing"},nativeOn:{click:function(e){return t.touchSort(e)}}})],1),t._v(" "),i("l-dialog",{staticClass:"disable-tip-dialog-wrapper",attrs:{show:t.dialogIsShow},on:{"update:show":function(e){t.dialogIsShow=e}}},[i("p",{staticClass:"msg-content"},[t._v(t._s(t.msgContent))])])],1)},staticRenderFns:[]};var D=i("C7Lr")(y,k,!1,function(t){i("QQzu")},null,null);e.default=D.exports}});